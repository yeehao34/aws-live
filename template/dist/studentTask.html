<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ITP - Student Task</title>

    <link rel="stylesheet" href="assets/css/main/app.css">
    <link rel="stylesheet" href="assets/css/main/app-dark.css">
    <link rel="shortcut icon" href="assets/images/logo/favicon.svg" type="image/x-icon">
    <link rel="shortcut icon" href="assets/images/logo/favicon.png" type="image/png">
    <link rel="stylesheet" href="assets/extensions/sweetalert2/sweetalert2.min.css">
</head>

<body>
    <div id="app">
        {# activePage is to determine which item to be active#}
        {% set activePage = "task" %}
        {% include "studentSidebar.html" %}
        <div id="main" class='layout-navbar'>
            {% include "studentHeader.html" %}
            <div id="main-content">

                <div class="page-heading">
                    <div class="page-title">
                        <div class="row">
                            <div class="col-12 col-md-6 order-md-1 order-last">
                                <h3>Task and Assignment</h3>
                                <p class="text-subtitle text-muted">View your task here and submit before due date.</p>
                            </div>
                        </div>
                    </div>
                    <section class="section">
                        <div class="section-header">
                            <h5 class="heading">Pending Task</h5>
                            <hr>
                        </div>
                        <div class="page-content">
                            <ul id="pendingTaskList" style="list-style-type:none;">
                            </ul>
                        </div>
                    </section>
                    <section class="section">
                        <div class="section-header">
                            <h5 class="heading">Completed Task</h5>
                            <hr>
                        </div>
                        <div class="page-content">
                            <ul id="completedTaskList" style="list-style-type:none;">
                            </ul>
                        </div>
                    </section>
                </div>

                {% include "footer.html" %}
            </div>
        </div>
    </div>
    <script src="assets/js/bootstrap.js"></script>
    <script src="assets/js/app.js"></script>
    <script src="assets/extensions/jquery/jquery.min.js"></script>
    <script src="assets/extensions/sweetalert2/sweetalert2.min.js"></script>
    <script src="assets/js/pages/sweetalert2.js"></script>

    <script>


        //define task array object, with task id, task title, task description, task due date, task attachment
        var task = [{
            taskId: 1,
            taskTitle: "Internship Documentation",
            taskDescription: "Some placeholder content for the collapse component. This panel is hidden by default but revealed when the user activates the relevant trigger.",
            taskDueDate: "24, Sep 11:59 PM",
            //task attachment with attachment name, attachment url
            taskAttachment: [{
                attachmentName: "Company Acceptance Form Template.docx",
                attachmentUrl: "/template/dist/auth-login.html"
            }, {
                attachmentName: "Parent Acknowledgement Form Template.docx",
                attachmentUrl: "/template/dist/auth-login.html"
            }, {
                attachmentName: "Letter of Indemnity Template.docx",
                attachmentUrl: "/template/dist/auth-login.html"
            }],
            submissionStatus: "Submitted"
        },
        {
            taskId: 2,
            taskTitle: "Progress Report 1",
            taskDescription: "Some placeholder content for the collapse component. This panel is hidden by default but revealed when the user activates the relevant trigger.",
            taskDueDate: "24, Sep 11:59 PM",
            //task attachment with attachment name, attachment url
            taskAttachment: [{
                attachmentName: "Progress Report Template.docx",
                attachmentUrl: "/template/dist/auth-login.html"
            }],
            submissionStatus: "Submitted"
        },
        {
            taskId: 3,
            taskTitle: "Progress Report 5",
            taskDescription: "Some placeholder content for the collapse component. This panel is hidden by default but revealed when the user activates the relevant trigger.",
            taskDueDate: "24, Sep 11:59 PM",
            //task attachment with attachment name, attachment url
            taskAttachment: [{
                attachmentName: "Progress Report Template.docx",
                attachmentUrl: "/template/dist/auth-login.html"
            }],
            submissionStatus: "Pending"
        }];

        var completedTask = [];
        var pendingTask = [];

        //loop through task array object, check submission status, if submission status is submitted, add task to completedTaskList, else add task to pendingTaskList
        for (var i = 0; i < task.length; i++) {
            if (task[i].submissionStatus == "Submitted") {
                completedTask.push(task[i]);
            } else {
                pendingTask.push(task[i]);
            }
        }
        console.log(completedTask);
        console.log(pendingTask);

        //create html for task list
        function createPendingTaskList() {
            var taskList = "";
            for (var i = 0; i < pendingTask.length; i++) {
                taskList += "<li><div class='card' data-bs-toggle='collapse' href='#task" + pendingTask[i].taskId +
                    "' role='button' aria-expanded='false' aria-controls='task" + pendingTask[i].taskId +
                    "'><div class='card-content'><div class='card-body'><div class='row'><div class='col-12 col-lg-1'><div class='avatar bg-primary me-3'><span class='avatar-content'><i class='bi bi-envelope'></i></span></div></div><div class='col-12 col-lg-8'><h5>" +
                    pendingTask[i].taskTitle + "</h5></div><div class='col-12 col-lg-3'>Due " + pendingTask[i].taskDueDate +
                    "</div></div><div class='collapse' id='task" + pendingTask[i].taskId + "'><hr><p id='taskDescription'>" +
                    pendingTask[i].taskDescription + "</p><p class='list-group' id='attachment'><h6>Attachment</h6>";
                for (var j = 0; j < pendingTask[i].taskAttachment.length; j++) {
                    taskList += "<a class='list-group-item' href='" + pendingTask[i].taskAttachment[j].attachmentUrl +
                        "' download><p>" + pendingTask[i].taskAttachment[j].attachmentName + "</p></a>";
                }
                taskList += "</p><hr><div class='row'><div class='col-12 d-flex justify-content-end'><button type='viewTask' class='btn btn-primary me-1 mb-1' id='viewTask'>View Instruction</button></div></div></div></div></div></div></li>";
            }
            return taskList;
        }

        //create html for completed task list
        function createCompletedTaskList() {
            var taskList = "";
            for (var i = 0; i < completedTask.length; i++) {
                taskList += "<li><div class='card' data-bs-toggle='collapse' href='#task" + completedTask[i].taskId +
                    "' role='button' aria-expanded='false' aria-controls='task" + completedTask[i].taskId +
                    "'><div class='card-content'><div class='card-body'><div class='row'><div class='col-12 col-lg-1'><div class='avatar bg-secondary me-3'><span class='avatar-content'><i class='bi bi-envelope'></i></span></div></div><div class='col-12 col-lg-8'><h5>" +
                    completedTask[i].taskTitle + "</h5></div><div class='col-12 col-lg-3'>Due " + completedTask[i].taskDueDate +
                    "</div></div><div class='collapse' id='task" + completedTask[i].taskId + "'><hr><p id='taskDescription'>" +
                    completedTask[i].taskDescription + "</p><p class='list-group' id='attachment'><h6>Attachment</h6>";
                for (var j = 0; j < completedTask[i].taskAttachment.length; j++) {
                    taskList += "<a class='list-group-item' href='" + completedTask[i].taskAttachment[j].attachmentUrl +
                        "' download><p>" + completedTask[i].taskAttachment[j].attachmentName + "</p></a>";
                }
                taskList += "</p><hr><div class='row'><div class='col-12 d-flex justify-content-end'><button type='viewTask' class='btn btn-primary me-1 mb-1' id='viewTask'>View Instruction</button></div></div></div></div></div></div></li>";
            }
            return taskList;
        }

        //display pendingTaskList and completedTaskList
        $('#pendingTaskList').html(createPendingTaskList());
        $('#completedTaskList').html(createCompletedTaskList());

        //click view button, get the task id, direct to view task page with task id as parameter
        $('#pendingTaskList').on('click', '#viewTask', function () {
            var taskId = $(this).closest('li').find('.card').attr('href').replace('#task', '');
            window.location.href = "/viewTask?taskId=" + taskId;
        });

        //click view button, get the task id, direct to view task page with task id as parameter
        $('#completedTaskList').on('click', '#viewTask', function () {
            var taskId = $(this).closest('li').find('.card').attr('href').replace('#task', '');
            window.location.href = "/viewTask?taskId=" + taskId;
        });
    </script>
</body>

</html>